<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REALSCAN — Advanced Scanner System</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --hacker-green: #0f0;
            --matrix-green: #00ff41;
            --hacker-red: #ff073a;
            --cyber-blue: #e6f7ff;
            --cyber-yellow: #ffe600;
            --cyber-purple: #c778ff;
            --white-text: #f0f0f0;
            --grey-text: #aaaaaa;
            --dark-bg: #0a0a0a;
            --terminal-bg: rgba(0, 20, 0, 0.8);
            --panel-bg: rgba(0, 30, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--white-text);
            font-family: 'Share Tech Mono', monospace;
            min-height: 100vh;
            padding: 20px;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(11, 255, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 0, 56, 0.05) 0%, transparent 20%),
                linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(0, 10, 0, 0.9));
            position: relative;
            overflow-x: hidden;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            color: var(--white-text);
            letter-spacing: 3px;
            text-shadow: 0 0 10px var(--hacker-green);
            margin-bottom: 10px;
            animation: titleGlow 3s infinite alternate;
        }

        .subtitle {
            color: var(--matrix-green);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .version {
            position: absolute;
            top: 0;
            right: 0;
            color: var(--grey-text);
            font-size: 0.8rem;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--hacker-green);
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .panel-title {
            color: var(--matrix-green);
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--hacker-green);
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-count {
            font-size: 0.9rem;
            color: var(--grey-text);
        }

        .status-indicators {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .status {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .online {
            background-color: var(--hacker-green);
            box-shadow: 0 0 5px var(--hacker-green);
        }

        .offline {
            background-color: var(--hacker-red);
        }

        .scan-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--grey-text);
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--hacker-green);
            color: var(--white-text);
            font-family: 'Share Tech Mono', monospace;
        }

        .btn {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--hacker-green);
            color: var(--hacker-green);
            padding: 12px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            background: rgba(0, 255, 0, 0.3);
        }

        .btn-primary {
            background: rgba(0, 255, 0, 0.2);
            animation: pulse 2s infinite;
        }

        .btn-danger {
            background: rgba(255, 0, 0, 0.1);
            border-color: var(--hacker-red);
            color: var(--hacker-red);
        }

        .btn-danger:hover {
            background: rgba(255, 0, 0, 0.3);
        }

        .log-container {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--hacker-green);
            padding: 10px;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }

        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px dotted rgba(0, 255, 0, 0.2);
            padding-bottom: 5px;
            display: flex;
        }

        .timestamp {
            color: var(--grey-text);
            margin-right: 10px;
            min-width: 80px;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 6px;
            background: rgba(0, 255, 0, 0.2);
            width: 100%;
            position: relative;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--hacker-green), var(--matrix-green));
            transition: width 0.3s;
        }

        .progress-text {
            text-align: right;
            font-size: 0.9rem;
            color: var(--matrix-green);
        }

        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .result-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--hacker-green);
            padding: 15px;
            border-radius: 5px;
        }

        .result-title {
            font-size: 1rem;
            color: var(--matrix-green);
            margin-bottom: 10px;
            border-bottom: 1px dashed var(--hacker-green);
            padding-bottom: 5px;
        }

        .result-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            text-align: center;
            margin: 10px 0;
        }

        .positive {
            color: var(--hacker-green);
            text-shadow: 0 0 5px var(--hacker-green);
        }

        .negative {
            color: var(--hacker-red);
            text-shadow: 0 0 5px var(--hacker-red);
        }

        .neutral {
            color: var(--cyber-yellow);
        }

        .game-list {
            max-height: 400px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .game-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            border-bottom: 1px dotted rgba(0, 255, 0, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .game-name {
            color: var(--white-text);
            font-size: 0.9rem;
        }

        .game-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: var(--grey-text);
            font-size: 0.8rem;
        }

        .search-box {
            margin-bottom: 15px;
        }

        #auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }

        .auth-container {
            background: rgba(0, 30, 0, 0.8);
            border: 2px solid var(--hacker-green);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px var(--hacker-green);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        #auth-overlay h1 {
            color: var(--hacker-green);
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--hacker-green);
        }

        #auth-overlay p {
            margin-bottom: 20px;
            color: var(--grey-text);
        }

        #access-code-input {
            padding: 12px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.7);
            color: var(--hacker-green);
            border: 1px solid var(--hacker-green);
            width: 100%;
            font-size: 1.2rem;
            text-align: center;
            letter-spacing: 2px;
        }

        #auth-overlay button {
            padding: 12px 25px;
            background: rgba(0, 255, 0, 0.2);
            color: var(--hacker-green);
            border: 1px solid var(--hacker-green);
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            margin-top: 15px;
            transition: all 0.3s;
            width: 100%;
        }

        #auth-overlay button:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px var(--hacker-green);
        }

        #auth-message {
            color: var(--hacker-red);
            margin-top: 15px;
            min-height: 20px;
        }

        .loading {
            display: none;
            margin-top: 15px;
        }

        .loading-dots {
            display: flex;
            justify-content: center;
        }

        .dot {
            width: 10px;
            height: 10px;
            background-color: var(--hacker-green);
            border-radius: 50%;
            margin: 0 5px;
            animation: pulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.3s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.6s;
        }

        .virtual-keyboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .key {
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--hacker-green);
            color: var(--hacker-green);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .key:hover {
            background: rgba(0, 255, 0, 0.2);
        }

        .key:active {
            background: var(--hacker-green);
            color: black;
        }

        .key-special {
            grid-column: span 2;
        }

        .note-box {
            background: #111;
            border: 1px dashed #ffe600;
            padding: 10px;
            margin-top: 10px;
            color: #ffe600;
            margin-bottom: 20px;
            display: none;
        }

        .access-timer {
            text-align: center;
            margin: 15px 0;
            font-size: 1.1rem;
            color: var(--cyber-yellow);
            font-family: 'Orbitron', sans-serif;
            display: none;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px var(--hacker-green); }
            100% { text-shadow: 0 0 20px var(--hacker-green), 0 0 30px var(--matrix-green); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px var(--hacker-green); }
            50% { box-shadow: 0 0 15px var(--hacker-green); }
            100% { box-shadow: 0 0 5px var(--hacker-green); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s;
        }

        @media (max-width: 968px) {
            .game-list {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }

            .title {
                font-size: 2rem;
            }

            .scan-controls {
                grid-template-columns: 1fr;
            }

            .results-container {
                grid-template-columns: 1fr;
            }

            .game-list {
                grid-template-columns: 1fr;
            }

            .auth-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="auth-overlay">
        <div class="auth-container">
            <h1>REALSCAN SECURE ACCESS</h1>
            <p>Enter your access code to continue</p>
            <input type="password" id="access-code-input" placeholder="Enter access code" autocomplete="off">
            <button onclick="validateAccessCode()">SUBMIT</button>
            <div class="virtual-keyboard">
                <div class="key" onclick="pressKey('1')">1</div>
                <div class="key" onclick="pressKey('2')">2</div>
                <div class="key" onclick="pressKey('3')">3</div>
                <div class="key" onclick="pressKey('4')">4</div>
                <div class="key" onclick="pressKey('5')">5</div>
                <div class="key" onclick="pressKey('6')">6</div>
                <div class="key" onclick="pressKey('7')">7</div>
                <div class="key" onclick="pressKey('8')">8</div>
                <div class="key" onclick="pressKey('9')">9</div>
                <div class="key" onclick="pressKey('0')">0</div>
                <div class="key key-special" onclick="backspace()">⌫</div>
            </div>
            <div id="auth-message"></div>
            <div class="loading" id="auth-loading">
                <div class="loading-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
                <p>Verifying access code...</p>
            </div>
        </div>
    </div>

    <div class="matrix-bg" id="matrixBg"></div>

    <div class="header">
        <div class="title">REALSCAN ADVANCED SYSTEM</div>
        <div class="subtitle">QUANTUM ANALYSIS & PREDICTIVE ENGINE</div>
        <div class="version">v3.5</div>
    </div>

    <div class="note-box" id="adminNote">Nota admin akan dipapar di sini selepas sahkan kod.</div>
    <div class="access-timer" id="accessTimer">⏳ Menunggu kod akses...</div>

    <div class="container">
        <div class="panel">
            <div class="panel-title">SYSTEM STATUS</div>
            <div class="status-indicators">
                <div class="status">
                    <div class="status-dot online"></div>
                    <span>API CONNECTION</span>
                </div>
                <div class="status">
                    <div class="status-dot online"></div>
                    <span>DATABASE SYNC</span>
                </div>
                <div class="status">
                    <div class="status-dot online"></div>
                    <span>ANALYSIS ENGINE</span>
                </div>
            </div>

            <div class="panel-title">SCAN CONTROLS</div>
            <div class="scan-controls">
                <div class="input-group">
                    <label for="gameType">GAME TYPE</label>
                    <select id="gameType">
                        <option value="slots">SLOT MACHINES</option>
                        <option value="table">TABLE GAMES</option>
                        <option value="fish">FISHING GAMES</option>
                        <option value="all">ALL GAMES</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="timeRange">TIME RANGE</label>
                    <select id="timeRange">
                        <option value="1">LAST 1 HOUR</option>
                        <option value="6">LAST 6 HOURS</option>
                        <option value="24" selected>LAST 24 HOURS</option>
                        <option value="72">LAST 3 DAYS</option>
                        <option value="168">LAST WEEK</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label for="specificGame">SPECIFIC GAME (OPTIONAL)</label>
                <input type="text" id="specificGame" placeholder="Enter game name for detailed analysis">
            </div>

            <div class="btn btn-primary" id="startScan">INITIATE ADVANCED SCAN</div>
            <div class="btn btn-danger" id="resetScan">RESET SCANNER</div>
        </div>

        <div class="panel">
            <div class="panel-title">REAL-TIME LOG</div>
            <div class="log-container" id="logContainer">
                <div class="log-entry"><span class="timestamp">[00:00:01]</span> System initialized</div>
                <div class="log-entry"><span class="timestamp">[00:00:03]</span> Database connected</div>
                <div class="log-entry"><span class="timestamp">[00:00:05]</span> API endpoints verified</div>
                <div class="log-entry"><span class="timestamp">[00:00:07]</span> Ready to scan</div>
            </div>

            <div class="panel-title">SCAN PROGRESS</div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0.00%</div>
            </div>

            <div class="panel-title">QUICK ACTIONS</div>
            <div class="scan-controls">
                <div class="btn" id="quickScan">QUICK SCAN</div>
                <div class="btn" id="deepScan">DEEP ANALYSIS</div>
                <div class="btn" id="saveResults">SAVE RESULTS</div>
                <div class="btn" id="exportData">EXPORT DATA</div>
                <div class="btn" id="downloadQuick">DOWNLOAD QUICK</div>
                <div class="btn" id="downloadDeep">DOWNLOAD DEEP</div>
            </div>
        </div>

        <div class="panel full-width">
            <div class="panel-title">SCAN RESULTS</div>
            <div class="results-container" id="resultsContainer">
                <div class="result-card">
                    <div class="result-title">OVERALL WIN RATE</div>
                    <div class="result-value positive" id="overallWinRate">0.00%</div>
                    <div class="result-title">TREND</div>
                    <div class="result-value positive" id="winRateTrend">+2.3%</div>
                </div>

                <div class="result-card">
                    <div class="result-title">TOP PERFORMING GAME</div>
                    <div class="result-value" id="topGame">Fortune Tiger</div>
                    <div class="result-value positive" id="topGameRate">62.45%</div>
                </div>

                <div class="result-card">
                    <div class="result-title">LOW PERFORMING GAME</div>
                    <div class="result-value" id="bottomGame">Dragon Hero</div>
                    <div class="result-value negative" id="bottomGameRate">38.12%</div>
                </div>

                <div class="result-card">
                    <div class="result-title">RECOMMENDATION</div>
                    <div class="result-value neutral" id="recommendation">MEDIUM RISK</div>
                    <div class="result-title">SUCCESS PROBABILITY</div>
                    <div class="result-value positive" id="successProbability">74.8%</div>
                </div>
            </div>
        </div>

        <div class="panel full-width">
            <div class="panel-title">
                DETAILED GAME ANALYSIS
                <span class="game-count" id="gameCount">0 games</span>
            </div>
            <div class="search-box">
                <input type="text" id="gameSearch" placeholder="Search game...">
            </div>
            <div class="game-list" id="gameList">
                <!-- Game items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <div class="footer">
        REALSCAN QUANTUM ANALYSIS SYSTEM v3.5 | Advanced Predictive Algorithm Technology | © 2025 Quantum Analytics Ltd.
    </div>

    <script>
        // ---------- Audio helper ----------
        let audioContext;
        function playSound(frequency, duration, type = 'sine') {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                gainNode.gain.value = 0.1;
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration / 1000);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (e) {
                console.log('Audio could not be played: ', e);
            }
        }

        // ---------- Authentication (unchanged logic) ----------
        function validateAccessCode() {
            const code = document.getElementById('access-code-input').value;
            const authMessage = document.getElementById('auth-message');
            const loading = document.getElementById('auth-loading');

            if (!code) {
                authMessage.textContent = 'Please enter an access code';
                playSound(100, 200, 'sawtooth');
                document.getElementById('access-code-input').classList.add('shake');
                setTimeout(() => {
                    document.getElementById('access-code-input').classList.remove('shake');
                }, 500);
                return;
            }

            loading.style.display = 'block';
            authMessage.textContent = '';

            fetch(`/api/validate?code=${encodeURIComponent(code)}`)
                .then(res => res.json())
                .then(j => {
                    loading.style.display = 'none';
                    if (!j.ok) {
                        authMessage.textContent = j.reason || 'Invalid code';
                        playSound(200, 500, 'square');
                        document.getElementById('access-code-input').classList.add('shake');
                        setTimeout(() => {
                            document.getElementById('access-code-input').classList.remove('shake');
                        }, 500);
                        return;
                    }

                    playSound(800, 300);
                    playSound(1000, 300);

                    const accessData = {
                        code: code,
                        expiresAt: j.expiresAt,
                        note: j.note || ''
                    };

                    localStorage.setItem('realscan_access_data', JSON.stringify(accessData));
                    localStorage.setItem('realscan_authenticated', 'true');

                    document.getElementById('auth-overlay').style.display = 'none';
                    document.getElementById('adminNote').textContent = j.note || 'No admin note';
                    document.getElementById('adminNote').style.display = 'block';
                    startCountdown(j.expiresAt);
                    addLogEntry('Security clearance granted. Quantum system initialized.');
                })
                .catch(err => {
                    loading.style.display = 'none';
                    authMessage.textContent = 'Network error';
                    console.error('Fetch /api/validate error:', err);
                });
        }

        function pressKey(key) {
            const input = document.getElementById('access-code-input');
            input.value += key;
            playSound(500, 50);
        }

        function backspace() {
            const input = document.getElementById('access-code-input');
            input.value = input.value.slice(0, -1);
            playSound(300, 50);
        }

        let countdownInterval = null;
        function startCountdown(expiresAt) {
            clearInterval(countdownInterval);
            const timerElement = document.getElementById('accessTimer');
            timerElement.style.display = 'block';

            function updateTimer() {
                const now = Date.now();
                const expTime = new Date(expiresAt).getTime();
                const remainSec = Math.max(0, Math.floor((expTime - now) / 1000));
                const hh = Math.floor(remainSec / 3600).toString().padStart(2, '0');
                const mm = Math.floor((remainSec % 3600) / 60).toString().padStart(2, '0');
                const ss = (remainSec % 60).toString().padStart(2, '0');
                timerElement.textContent = `⏳ Baki masa akses: ${hh}:${mm}:${ss}`;

                if (remainSec <= 0) {
                    clearInterval(countdownInterval);
                    timerElement.textContent = '❌ Akses tamat.';
                    localStorage.removeItem('realscan_authenticated');
                    localStorage.removeItem('realscan_access_data');
                    alert('Kod akses telah tamat. Sila hubungi admin untuk kod baru.');
                    document.getElementById('auth-overlay').style.display = 'flex';
                }
            }

            updateTimer();
            countdownInterval = setInterval(updateTimer, 1000);
        }

        function checkAuthentication() {
            const isAuthenticated = localStorage.getItem('realscan_authenticated') === 'true';
            const accessDataStr = localStorage.getItem('realscan_access_data');
            if (isAuthenticated && accessDataStr) {
                const accessData = JSON.parse(accessDataStr);
                const expiresAt = new Date(accessData.expiresAt).getTime();
                const now = Date.now();
                if (now < expiresAt) {
                    document.getElementById('auth-overlay').style.display = 'none';
                    document.getElementById('adminNote').textContent = accessData.note || 'No admin note';
                    document.getElementById('adminNote').style.display = 'block';
                    startCountdown(accessData.expiresAt);
                    return true;
                } else {
                    localStorage.removeItem('realscan_authenticated');
                    localStorage.removeItem('realscan_access_data');
                }
            }
            return false;
        }

        // ---------- Game list (only names; remove preset baseRate/volatility) ----------
        const games = [
            { name: "Dragon Hero" },
            { name: "Wolf Run" },
            { name: "Gifts From Santa" },
            { name: "Zombie Carnival" },
            { name: "God Of Cookery" },
            { name: "Cash Noire" },
            { name: "Deep Trek" },
            { name: "Sticky Bandit" },
            { name: "Vegas Night Life" },
            { name: "King Of Pop" },
            { name: "Wild Fireworks" },
            { name: "Cocktail Night" },
            { name: "Fortune Tiger" },
            { name: "King Of Ghost" },
            { name: "Sushi Qishi" },
            { name: "Razor Shark" },
            { name: "Six Acrobats" },
            { name: "Super Keno" },
            { name: "Conan" },
            { name: "Clash Of The Beasts" },
            { name: "Hot Shot Keno" },
            { name: "BeastOf Wealth" },
            { name: "Celebrations Of Wealth" },
            { name: "Dim Sum Prize" },
            { name: "Jin Chan's Pond Of Riches" },
            { name: "Agent 51" },
            { name: "The Good Life" },
            { name: "Lights" },
            { name: "Caishen's Gold" },
            { name: "Narcos" },
            { name: "Dwarfs Of Wild" },
            { name: "Words Of Khans" },
            { name: "Golden Beauty" },
            { name: "Magic Shoppe" },
            { name: "Chinese New Year" },
            { name: "Lotus Lagend" },
            { name: "Temple Of Wealth" },
            { name: "Fortune Panda" },
            { name: "Jin Qian Wa" },
            { name: "Lative Indian" },
            { name: "Cleopatra Riches" },
            { name: "Lucky Neko" },
            { name: "Great88" },
            { name: "Lucky Koi" },
            { name: "Dragon Strike" },
            { name: "Steam Tower" },
            { name: "Lucky Little God" },
            { name: "Fart Girl" },
            { name: "Golden" },
            { name: "Robin Sherwood" },
            { name: "Dragon Maiden" },
            { name: "Jingle Bell" },
            { name: "Fortune Charm" },
            { name: "Blaze Of Ra" },
            { name: "Temple Quest" },
            { name: "House Doom" },
            { name: "Golden Monkey" },
            { name: "Chinese Lion" },
            { name: "Royal Masquerate" },
            { name: "Santa" },
            { name: "Gold Rush" },
            { name: "Lucky New Year" },
            { name: "Hotline" },
            { name: "Sizzling Spin" },
            { name: "Dark Vortex" },
            { name: "Champions Rome" },
            { name: "Tigers Glory" },
            { name: "Ivan Of The Immortalkings" },
            { name: "Jungle Spirit" },
            { name: "Masquerate" },
            { name: "Xmas Magic" },
            { name: "Dr Fortuno" },
            { name: "Golden Colts" },
            { name: "Fortune Fireworks" },
            { name: "Big Chef" },
            { name: "Matsuri" },
            { name: "Cash Vandal" },
            { name: "Circus" },
            { name: "Legend" },
            { name: "Raging Rex" },
            { name: "Jackpot Riders" },
            { name: "Desert Gem" },
            { name: "Top Gun" },
            { name: "Midas" },
            { name: "Handos Dojo" },
            { name: "Wolf Hunters" },
            { name: "Yin & Yang" },
            { name: "Nitro's" },
            { name: "Penguin City" },
            { name: "Halloween Fortune" },
            { name: "Custer Surprise" },
            { name: "Lost Island" },
            { name: "Fruits & Candy" },
            { name: "Silent Run" },
            { name: "Sun Wo Kong" },
            { name: "Snow World" },
            { name: "Lucky Duck" },
            { name: "Big Win Cat" },
            { name: "Elven Magic" },
            { name: "Football Carnival" },
            { name: "Ireland" },
            { name: "Dragonz" },
            { name: "Manic Millions" },
            { name: "Lion Dance" },
            { name: "Fortunefest" },
            { name: "Da si xi" },
            { name: "Robin Hood" },
            { name: "Alice" },
            { name: "African Wild Life" },
            { name: "Seasons Greeting" },
            { name: "Laura" },
            { name: "Pirate" },
            { name: "Amazon Jungle" },
            { name: "Pirate Ship" },
            { name: "Aladdin" }
        ];

        // ---------- DOM elements ----------
        const logContainer = document.getElementById('logContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const startScanBtn = document.getElementById('startScan');
        const resetScanBtn = document.getElementById('resetScan');
        const quickScanBtn = document.getElementById('quickScan');
        const deepScanBtn = document.getElementById('deepScan');
        const saveResultsBtn = document.getElementById('saveResults');
        const exportDataBtn = document.getElementById('exportData');
        const downloadQuickBtn = document.getElementById('downloadQuick');
        const downloadDeepBtn = document.getElementById('downloadDeep');
        const gameList = document.getElementById('gameList');
        const gameCount = document.getElementById('gameCount');
        const gameSearch = document.getElementById('gameSearch');
        const matrixBg = document.getElementById('matrixBg');

        const overallWinRate = document.getElementById('overallWinRate');
        const winRateTrend = document.getElementById('winRateTrend');
        const topGame = document.getElementById('topGame');
        const topGameRate = document.getElementById('topGameRate');
        const bottomGame = document.getElementById('bottomGame');
        const bottomGameRate = document.getElementById('bottomGameRate');
        const recommendation = document.getElementById('recommendation');
        const successProbability = document.getElementById('successProbability');

        // ---------- Utility ----------
        function addLogEntry(message) {
            const now = new Date();
            const timestamp = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">${timestamp}</span> ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateProgress(percent) {
            progressFill.style.width = percent + '%';
            progressText.textContent = percent.toFixed(2) + '%';
        }

        function createMatrixEffect() {
            const characters = '01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';
            const fontSize = 14;
            const columns = Math.floor(window.innerWidth / fontSize);
            const drops = [];
            for (let i = 0; i < columns; i++) drops[i] = 1;

            const canvas = document.createElement('canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            matrixBg.appendChild(canvas);
            const ctx = canvas.getContext('2d');

            function rain() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#0F0';
                ctx.font = fontSize + 'px monospace';
                for (let i = 0; i < drops.length; i++) {
                    const text = characters.charAt(Math.floor(Math.random() * characters.length));
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            setInterval(rain, 33);
        }

        // ---------- Random win rate generator per your spec ----------
        let lastResults = { games: [], overall: 0 };

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            if (max < min) return min;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateRandomWinRates() {
            const totalGames = games.length;

            // Green: 5-15 but not exceeding totalGames
            const greenCount = getRandomInt(5, Math.min(15, totalGames));

            // Remaining after green
            let remaining = totalGames - greenCount;

            // Yellow: try to allocate 30-40 but clamp to remaining
            let yellowMin = 30;
            let yellowMax = 40;
            if (remaining <= 0) {
                // No yellow or red
                return { greenCount, yellowCount: 0, redCount: 0, totalGames, allRates: [] };
            }

            let yellowCount;
            if (remaining >= yellowMin) {
                yellowCount = getRandomInt(yellowMin, Math.min(yellowMax, remaining));
            } else {
                // Not enough for full 30; allocate as many as possible (to avoid negative red)
                yellowCount = remaining; // all remaining become yellow (red=0)
            }

            const redCount = totalGames - greenCount - yellowCount;

            // Build rates arrays
            const greenRates = Array.from({ length: greenCount }, () => parseFloat((70 + Math.random() * 29.99).toFixed(2)));
            const yellowRates = Array.from({ length: yellowCount }, () => parseFloat((45 + Math.random() * 24.99).toFixed(2)));
            const redRates = Array.from({ length: Math.max(0, redCount) }, () => parseFloat((0.01 + Math.random() * 44.98).toFixed(2)));

            const allRates = [...greenRates, ...yellowRates, ...redRates];

            // Shuffle rates so they don't cluster
            for (let i = allRates.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allRates[i], allRates[j]] = [allRates[j], allRates[i]];
            }

            return { allRates, greenCount, yellowCount, redCount, totalGames };
        }

        function calculateWinRates() {
            const gen = generateRandomWinRates();
            const shuffledGames = [...games].sort(() => Math.random() - 0.5);
            const results = [];
            let totalRate = 0;

            for (let i = 0; i < shuffledGames.length; i++) {
                const rate = gen.allRates[i] || parseFloat((0.01 + Math.random() * 99.98).toFixed(2));
                results.push({
                    name: shuffledGames[i].name,
                    rate: rate
                });
                totalRate += rate;
            }

            const overallRate = parseFloat((totalRate / games.length).toFixed(2));

            // Sort games by rate desc for display on top/bottom
            const sorted = results.slice().sort((a, b) => b.rate - a.rate);

            lastResults = { games: sorted, overall: overallRate };
            return lastResults;
        }

        function updateGameList(resultGames) {
            gameList.innerHTML = '';
            gameCount.textContent = `${resultGames.length} games`;

            resultGames.forEach(game => {
                const gameItem = document.createElement('div');
                gameItem.className = 'game-item';

                let valueClass;
                if (game.rate >= 70) {
                    valueClass = 'positive'; // HIJAU
                } else if (game.rate >= 45) {
                    valueClass = 'neutral'; // KUNING (styled as neutral/yellow)
                } else {
                    valueClass = 'negative'; // MERAH
                }

                gameItem.innerHTML = `
                    <span class="game-name">${game.name}</span>
                    <span class="game-value ${valueClass}">${game.rate}%</span>
                `;

                gameList.appendChild(gameItem);
            });
        }

        function filterGames(searchTerm) {
            if (!lastResults || !lastResults.games || lastResults.games.length === 0) {
                // If no results yet, generate one set (so filtering happens on a stable dataset)
                calculateWinRates();
            }

            const results = lastResults.games;
            if (!searchTerm) return results;
            return results.filter(game => game.name.toLowerCase().includes(searchTerm.toLowerCase()));
        }

        function updateResults(results) {
            overallWinRate.textContent = results.overall + '%';
            overallWinRate.className = 'result-value ' + (results.overall >= 50 ? 'positive' : 'negative');

            const trend = (Math.random() * 10 - 5).toFixed(1);
            winRateTrend.textContent = (trend > 0 ? '+' : '') + trend + '%';
            winRateTrend.className = 'result-value ' + (trend >= 0 ? 'positive' : 'negative');

            if (results.games.length > 0) {
                topGame.textContent = results.games[0].name;
                topGameRate.textContent = results.games[0].rate + '%';

                bottomGame.textContent = results.games[results.games.length - 1].name;
                bottomGameRate.textContent = results.games[results.games.length - 1].rate + '%';
            }

            if (results.overall >= 55) {
                recommendation.textContent = 'HIGH SUCCESS';
                recommendation.className = 'result-value positive';
                successProbability.textContent = (75 + Math.random() * 20).toFixed(1) + '%';
            } else if (results.overall >= 48) {
                recommendation.textContent = 'MEDIUM RISK';
                recommendation.className = 'result-value neutral';
                successProbability.textContent = (60 + Math.random() * 15).toFixed(1) + '%';
            } else {
                recommendation.textContent = 'HIGH RISK';
                recommendation.className = 'result-value negative';
                successProbability.textContent = (40 + Math.random() * 15).toFixed(1) + '%';
            }
        }

        // ---------- Scanning flow ----------
        function performScan(isQuick = false) {
            addLogEntry("Starting " + (isQuick ? "quick" : "advanced") + " analysis...");
            let progress = 0;
            const interval = setInterval(() => {
                progress += isQuick ? 12 : 6;

                if (progress <= 25) {
                    addLogEntry(`Connecting to game servers... ${progress}%`);
                } else if (progress <= 50) {
                    addLogEntry(`Analyzing historical data... ${progress}%`);
                } else if (progress <= 75) {
                    addLogEntry(`Calculating probability models... ${progress}%`);
                } else if (progress < 100) {
                    addLogEntry(`Compiling results... ${progress}%`);
                } else {
                    clearInterval(interval);
                    addLogEntry("Analysis complete! Results ready.");

                    const results = calculateWinRates();
                    updateGameList(results.games);
                    updateResults(results);

                    saveResultsBtn.disabled = false;
                    exportDataBtn.disabled = false;
                    startScanBtn.disabled = false;
                    resetScanBtn.disabled = false;
                }

                updateProgress(Math.min(progress, 100));
            }, isQuick ? 200 : 350);
        }

        // ---------- Download result ----------
        function downloadResult(isDeep = false) {
            const accessDataStr = localStorage.getItem('realscan_access_data');
            const accessData = accessDataStr ? JSON.parse(accessDataStr) : {};
            const now = new Date().toLocaleString('ms-MY', { hour12: false });

            let txt = `REALSCAN RESULT\nKod Akses: ${accessData.code || 'N/A'}\nTarikh/Masa: ${now}\nNota Admin: ${accessData.note || ''}\n` +
                      `Mod: ${isDeep ? 'DEEP SCAN' : 'QUICK SCAN'}\n\nHASIL IMBASAN:\n\n`;

            if (lastResults && lastResults.games) {
                lastResults.games.forEach(g => {
                    txt += `${g.name}: ${g.rate}%\n`;
                });
            } else {
                txt += 'No results generated\n';
            }

            const blob = new Blob([txt], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `scanner-result-${accessData.code || 'NA'}-${isDeep ? 'DEEP' : 'QUICK'}.txt`;
            link.click();
        }

        // ---------- Event bindings ----------
        startScanBtn.addEventListener('click', () => {
            startScanBtn.disabled = true;
            resetScanBtn.disabled = true;
            saveResultsBtn.disabled = true;
            exportDataBtn.disabled = true;
            performScan(false);
        });

        quickScanBtn.addEventListener('click', () => {
            startScanBtn.disabled = true;
            resetScanBtn.disabled = true;
            saveResultsBtn.disabled = true;
            exportDataBtn.disabled = true;
            performScan(true);
        });

        resetScanBtn.addEventListener('click', () => {
            updateProgress(0);
            logContainer.innerHTML = '';
            gameList.innerHTML = '';
            gameSearch.value = '';

            overallWinRate.textContent = '0.00%';
            winRateTrend.textContent = '+0.0%';
            topGame.textContent = 'N/A';
            topGameRate.textContent = '0.00%';
            bottomGame.textContent = 'N/A';
            bottomGameRate.textContent = '0.00%';
            recommendation.textContent = 'NONE';
            successProbability.textContent = '0.0%';

            lastResults = { games: [], overall: 0 };

            startScanBtn.disabled = false;
            saveResultsBtn.disabled = true;
            exportDataBtn.disabled = true;

            addLogEntry("System reset completed");
            addLogEntry("Ready to scan");
        });

        deepScanBtn.addEventListener('click', () => {
            addLogEntry("Deep analysis requires additional permissions");
            addLogEntry("Please contact administrator for access");
        });

        saveResultsBtn.addEventListener('click', () => {
            addLogEntry("Saving results to database...");
            setTimeout(() => addLogEntry("Results saved successfully"), 1500);
        });

        exportDataBtn.addEventListener('click', () => {
            addLogEntry("Exporting data to CSV format...");
            setTimeout(() => addLogEntry("Data exported successfully"), 1500);
        });

        downloadQuickBtn.addEventListener('click', () => downloadResult(false));
        downloadDeepBtn.addEventListener('click', () => downloadResult(true));

        gameSearch.addEventListener('input', () => {
            const filtered = filterGames(gameSearch.value);
            updateGameList(filtered);
        });

        document.getElementById('access-code-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') validateAccessCode();
        });

        // ---------- Initialize on load ----------
        window.addEventListener('load', function() {
            // Jika halaman dibuka dengan ?code=XXXXXX, autofill dan cuba validate automatik
            const params = new URLSearchParams(window.location.search);
            const codeParam = params.get('code');
            if (codeParam) {
                document.getElementById('access-code-input').value = codeParam;
                validateAccessCode();
            } else {
                if (!checkAuthentication()) {
                    document.getElementById('auth-overlay').style.display = 'flex';
                }
            }
            document.getElementById('access-code-input').focus();

            createMatrixEffect();
            addLogEntry("System initialized successfully");
            addLogEntry("REALSCAN Quantum Scanner v3.5 ready");

            gameCount.textContent = `${games.length} games`;

            saveResultsBtn.disabled = true;
            exportDataBtn.disabled = true;
        });
    </script>
</body>
</html>
